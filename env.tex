% !TEX TS-program = ConTeXt (LuaTeX)
% !TEX encoding = UTF-8

%		EASILY FORGOTTON COMMANDS
%		\unknown (ellipsis)
%
%
%		HEIRACY
%		\startpart[title={Part}]
%		\startchapter[title={Chapter}]
%		\startsection[title={Section}]
%		\startsubsection[title={Subsection}]
%		\startsubsubsection[title={Subsubsection}]
%		\startsubsubsubsection[title={Subsubsubsection}]
%		\startsubsubsubsubsection[title={Subsubsubsubsection}]
%

\startenvironment
	\version[final]    % show overful hboxes = temporary (final concept temporary)

	% LANGUAGE AND INPUT SETTINGS
	\enableregime[utf]
	\mainlanguage[en-gb]
	\language[en-gb]

	% CUSTOM HYPHEN PATTERNS, todo, extract to different file
	\hyphenation{be-cause re-vealed our-selves re-form-ed there-by zechari-ah ex-traor-di-nary} % separate words with space, no csv

	% DEFINE CUSTOM PAPER SIZES
	\definepapersize[5x8][width=5in,height=8in]
	\definepapersize[demy8vo][width=5.5in,height=8.5in]
	\definepapersize[6x9][width=6in,height=9in]
	\definepapersize[royal8vo][width=6.14in,height=9.21in]

	% WHICH PAPER TO USE
	\setuppapersize[6x9][6x9] % paper size on paper size

	%
	%	SCREEN OR PRINT
	%

	\startmode[screen]
	  \setuplayout[location=singlesided]
	  \setuppagenumbering[location={footer,center},state=stop] % alternative=doublesided
		%BLOCK SETUP
		\setupsectionblock[frontpart][page=no]
		\setupsectionblock[bodypart][page=no]
		\setupsectionblock[appendix][page=no]
		\setupsectionblock[backpart][page=no]
	\stopmode

	% Doublesided
	\startnotmode[screen]
		\setuplayout[location=doublesided]
		\setuppagenumbering[location={footer,right},alternative=doublesided,state=stop]
		%BLOCK SETUP
		\setupsectionblock[frontpart][page=right]
		\setupsectionblock[bodypart][page=right]
		\setupsectionblock[appendix][page=right]
		\setupsectionblock[backpart][page=right]

%		\setuplayout[
%			width=middle,
%			height=middle,
%			backspace=.75 in,
%			topspace=.5 in,
%			header=.25 in,
%			footer=0 in,
%			headerdistance=.25 in,
%			footerdistance=0 in,
%			bottomspace=0.9 in,
%			cutspace=.875 in,
%		]


	\stopnotmode

	%
	%	END SCREEN OR PRINT
	%



	% TABLE OF CONTENTS
	\setupheadtext[content={Contents}]
	\setuplist[part][width=0mm,style={\bf}]
	\setuplist[chapter][width=5mm,style={\tf}]
	\setuplist[section][width=10mm,style=]
	\setuplist[subsection][width=15mm,style={\tfx}]

	%\setupcombinedlist[content][list={part,chapter,section,subsection}]

	% TYPE SETTINGS
	\definefontfeature[default][default][mode=node,protrusion=quality,expansion=quality,onum=yes,dlig=no,liga=yes,hlig=no,kern=yes,script=latn]
	\setuplayout[grid=yes] % grid spacing enabled
	\setupalign[hz,hanging] % hz=expansion & hanging=protrusion microtype
	\setupfootnotes[align={hz,hanging}]

	% TYPESCRIPTS
	% Make new file
	\starttypescript[serif][crimson]
		\setups[font:fallback:serif]
		\definefontsynonym[Serif][file:crimsonroman][features=default]
		\definefontsynonym[SerifItalic][file:crimsonitalic][features=default]
		\definefontsynonym[SerifBold][file:crimsonbold][features=default]
		\definefontsynonym[SerifBoldItalic][file:crimsonbolditalic][features=default]
	\stoptypescript

	\starttypescript[serif][calluna]
		\setups[font:fallback:serif]
		\definefontsynonym[Serif][file:callunaregular][features=default]
		\definefontsynonym[SerifItalic][file:callunait][features=default]
		\definefontsynonym[SerifBold][file:callunabold][features=default]
		\definefontsynonym[SerifBoldItalic][file:callunaboldit][features=default]
	\stoptypescript

	\starttypescript[serif][cormorant]
		\setups[font:fallback:serif]
		\definefontsynonym[Serif][file:cormorantgaramondbook][features=default]
		\definefontsynonym[SerifItalic][file:cormorantgaramonditalic][features=default]
		\definefontsynonym[SerifBold][file:cormorantgaramondbold][features=default]
		\definefontsynonym[SerifBoldItalic][file:cormorantgaramondsemibolditalic][features=default]
	\stoptypescript

	\starttypescript[serif][minion]
		\setups[font:fallback:serif]
		\definefontsynonym[Serif][file:minionproregular][features=default]
		\definefontsynonym[SerifItalic][file:minionproit][features=default]
		\definefontsynonym[SerifBold][file:minionprobold][features=default]
		\definefontsynonym[SerifBoldItalic][file:minionproboldit][features=default]
	\stoptypescript

	\definetypeface[calluna][rm][serif][calluna][default]
	\definetypeface[crimson][rm][serif][crimson][default]
	\definetypeface[minion][rm][serif][minion][default]
	\definetypeface[cormorant][rm][serif][cormorant][default]

	% WHAT FONT TO SET
	\setupbodyfontenvironment[12pt][em=italic] %default
	\setupbodyfont[crimson,12pt] %default

	\startmode[cormorant]
		\setupbodyfont[cormorant]
	\stopmode
	\startmode[minion]
		\setupbodyfont[minion]
	\stopmode
	\startmode[calluna]
		\setupbodyfont[calluna]
	\stopmode
	\startmode[crimson]
		\setupbodyfont[crimson]
	\stopmode

	\doifmode{11}{
		\setupbodyfontenvironment[11pt][em=italic]
		\setupbodyfont[11pt]
	}
	\doifmode{10}{
		\setupbodyfontenvironment[10pt][em=italic]
		\setupbodyfont[10pt]
	}
	\doifmode{9}{
		\setupbodyfontenvironment[10pt][em=italic]
		\setupbodyfont[9pt]
	}
	\doifmode{8}{
		\setupbodyfontenvironment[10pt][em=italic]
		\setupbodyfont[8pt]
	}


	% INDENTING
	\setupindenting[yes,small,next]

	% STRUCTURALS SETTINGS
	\definestructureresetset[default][1,1,1][1] % reset chapters [part,chapter,section]
	\setuphead[sectionresetset=default]

	\setuphead[part][conversion=I,placehead=yes,alternative=middle,before=\startstandardmakeup,after=\stopstandardmakeup,header=empty]
	\setuphead[chapter][page=yes,number=yes,style={\tfc \bf},sectionsegments=chapter,align=nothyphenated,header=empty,numbercommand={}]
	\setuphead[section][page=no,number=yes,header=,sectionsegments=section,numbercommand={\DAN},alternative=,before={\blank},after=,style={\tfb \bf},inbetween=,]
	\setuphead[subsection][commandbefore={\startnarrower},commandafter={\stopnarrower},page=no,number=no,header=,sectionsegments=section,numbercommand={},alternative=,before={\blank},after={\blank},style={\sc},inbetween=,align=middle]
	\setuphead[subsubsection][page=no,number=no,header=,sectionsegments=section,numbercommand={},alternative=,before={\blank},after={\blank},style={\sc},inbetween=,align=middle]

	% HEADER SETTINGS
	\setupheader[style=\word \sc]
	\setupheadertexts[chapter]%[chapter][part]

	%FOOTNOTES
	%\setupnotation[footnote][numberconversion=characters, alternative=serried, display=no,]
	%\setupnote[footnote][paragraph=yes, location=text, interaction=yes,]
	%\setupnote[footnote][before={\blank[2*line]}]

	% DISABLE ALL FOOTNOTES
	%\notesenabledfalse

	% TITLE PAGE
	\definemakeup[titlepage][pagestate=stop,doublesided=no,header=empty,footer=empty]

	% Roman numerals in front part
	\startsectionblockenvironment[frontpart]
		\definestructureconversionset [frontpart:pagenumber] [] [romannumerals]
	\stopsectionblockenvironment


	% TWEEKS
	%\clubpenalty=10000 %  no clubs
	%\widowpenalty=10000 %  no widows
	%\emergencystretch=12 pt %
	%\setuptolerance[tolerant] %

	% DIAGNOSTICS
	%\showgrid
	%\showstruts
	%\showsetups %put into body
	%\showboxes
	%\enabletrackers[typesetters.suspects]

	% CUSTOM COMMANDS
	\define[1]\DAN{#1.}	% Dot After Number for heads

	\define\fin{\blank[1*big]\midaligned{{\sc fin}}}	% fin on last page
	\define\finis{\blank[1*big]\midaligned{{\sc finis}}}	% fin on last page

	\define[2]\pdftitle{
		\setupinteraction[state=start,  % make hyperlinks active, etc.
	  		title={#1},
	  		subtitle={#2},
	  		author={Presbyterian Church of Victoria},
	  		keyword={},
	  		color=black,
	  		contrastcolor=black]
		\placebookmarks[part,chapter,section,subsection][part,chapter][force=yes] %force=yes is because title does not go unless explicitly set
		\setupinteractionscreen[option=bookmark]
	}

%
%	TITLE PAGE & IMPRINT MACRO
%
	\define[6]\titlepage{ 	%title,author,year,year printed,isbn,blurb
		\setuppagenumbering[state=stop]
		% TITLE PAGE
		\starttitlepagemakeup

		\startalignment[middle]
	  		\dontleavehmode
			\blank[3*big]
	    			{\tfd \bf #1} % Title\description
	  		\blank[1*big]
	    		{\tfa \sc \word #2} % AUTHOR
			\blank[1*small]
				{\tfa \em #3} % YEAR
	  		\blank[12*big]
				\dontleavehmode
	    			\externalfigure[../2016.eps][width=25.4mm] % svg logo
				\\ {\tf \sc \word Presbyterian Church of Victoria}
	  	\stopalignment
		\stoptitlepagemakeup
		% END TITLE PAGE
		%IMPRINT
		\startnotmode[screen]
			\page[yes]
		\stopnotmode
		{\tfx #6} % top of imprint page (blurb)

		\strut\vfill
		\framed[frame=off, align=bottom]{{\tf \bf #1}\blank
			{\tfx Presbyterian Church of Victoria\\
			%Christian Education \& Nurture Committee\\
			156 Collins Street,\\Victoria, Australia\\
			\blank
			Typeset with the open source typesetter \CONTEXT \\
			This edition first published by the Presbyterian Church of Victoria in #4 \\
			{\word \sc ISBN} #5}

		} % framed

	} % define[6]\titlepage


	%
	%	FRONT MATTER MACRO
	%

	\define\supercamstart{
		\newtitlepage
		\centreimprintpage
		\completecontent[list={part}]
		\dedication
		\preface
	}

%titlepage
	\define\newtitlepage{ 	%title,author,year,year printed,isbn,blurb
		\setuppagenumbering[state=stop]
		\starttitlepagemakeup
			\startalignment[middle]
	  			\dontleavehmode
					\blank[3*big]
	    				{\tfd \bf \getvariable{supercam}{title}} % Title\description
	  				\blank[1*big]
	    				{\tfa \sc \word \getvariable{supercam}{subtitle}} % AUTHOR or subtitle
					\blank[1*small]
						{\tfa \em \getvariable{supercam}{year}} % YEAR or author
	  				\blank[12*big]
				\dontleavehmode
	    			\externalfigure[../2016.eps][width=25.4mm] % svg logo
				\\ {\tf \sc \word \getvariable{supercam}{publisher}}
	  	\stopalignment
		\stoptitlepagemakeup
	}

%imprintpage
	\define\newimprintpage{
		\startnotmode[screen]
			\page[yes]
		\stopnotmode
		{\tfx \getvariable{supercam}{blurb}} % top of imprint page (blurb)
		\strut\vfill
		\framed[frame=off, align=bottom]{{\tf \bf \getvariable{supercam}{title}}\blank
			{\tfx \getvariable{supercam}{publisher}\\
			%Christian Education \& Nurture Committee\\
			156 Collins Street,\\Victoria, Australia\\
			\blank
			Typeset with the open source typesetter \CONTEXT \\
			This edition first published by the \getvariable{supercam}{publisher} in \getvariable{supercam}{year} \\
			{\word \sc ISBN} \getvariable{supercam}{isbn}}
		}
	}

%imprintpage
	\define\centreimprintpage{
		\startstandardmakeup
			\startalignment[center]
			{\bf \getvariable{supercam}{title}}\\
			{\em \getvariable{supercam}{author}}
			\blank
			\tfx \getvariable{supercam}{publisher}\\
			156 Collins Street, Melbourne, Australia\\
			+61 3 9650 9311\\
			pcv.org.au
			\blank
			{\em This work is copyright. Apart from any use permitted under the Copyright Act 1968, no part may be reproduced by any process, nor 				may any other exclusive right be exercised, without express permission.}\\
			\\
			Scripture quotations are from the ESV® Bible (The Holy Bible, English Standard Version®), copyright © 2001 by Crossway, a publishing 					ministry of Good News Publishers. Used by permission. All rights reserved.\\
			\\
			Typeset with \CONTEXT\ by the \getvariable{supercam}{publisher} in \getvariable{supercam}{year}.\\
			\\
			{\word \sc ISBN:} \getvariable{supercam}{isbn}
			\stopalignment
		\stopstandardmakeup
	}

%	DEDICATION PAGE
\define\dedication{
	\page
		\startstandardmakeup
			\startalignment[center]
				{\em \getvariable{supercam}{dedication}}
				\blank[16*big]
			\stopalignment
		\stopstandardmakeup
	\page
}

% Preface
\define\preface{
	\startchapter[title={Preface}]
	\setuppagenumbering[state=start]
	\getvariable{supercam}{preface}
	\stopchapter
}


\stopenvironment
